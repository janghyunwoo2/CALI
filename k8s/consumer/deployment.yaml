# =====================================================
# Consumer Deployment
# =====================================================
# 설명: Python Consumer 애플리케이션 배포
# 역할: Kinesis 구독 → RAG 분석 → Slack 알림
# =====================================================

apiVersion: apps/v1
kind: Deployment
metadata:
  name: cali-consumer
  namespace: cali-system
  labels:
    app: cali-consumer
spec:
  replicas: 2
  selector:
    matchLabels:
      app: cali-consumer
  template:
    metadata:
      labels:
        app: cali-consumer
    spec:
      serviceAccountName: cali-consumer
      containers:
      - name: consumer
        image: <ECR_REPOSITORY_URL>/consumer:latest  # TODO: ECR URL로 변경
        env:
        - name: AWS_REGION
          value: "ap-northeast-2"
        - name: KINESIS_STREAM_NAME
          value: "cali-log-stream"
        # TODO: Secrets Manager 연동으로 환경 변수 주입
        resources:
          limits:
            memory: 512Mi
            cpu: 500m
          requests:
            memory: 256Mi
            cpu: 250m
        livenessProbe:
          exec:
            command:
            - python
            - -c
            - "print('healthy')"
          initialDelaySeconds: 30
          periodSeconds: 30
