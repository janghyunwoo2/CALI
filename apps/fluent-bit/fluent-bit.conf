[SERVICE]
    Flush         1
    Daemon        Off
    Log_Level     info
    Parsers_File  parsers.conf

[INPUT]
    Name             tail
    Path             /logs/app.log
    Tag              cali.production.logs
    Read_from_Head   On
    # 중요: 여기서 바로 파싱하지 않고 멀티라인으로 먼저 합칩니다.
    multiline.parser multiline_start
    db               /logs/fluent-bit-state.db

[FILTER]
    # 합쳐진 로그 덩어리에서 필드(level, timestamp 등)를 추출합니다.
    Name            parser
    Match           cali.production.logs
    Key_Name        log
    Parser          cali_logic_parser
    Reserve_Data    On

[FILTER]
    Name            modify
    Match           cali.production.logs
    Add             platform CALI-MTTR-Optimizer
    Add             environment production

[OUTPUT]
    Name            kinesis_streams
    Match           cali.production.logs
    Region          ${AWS_REGION}
    Stream          ${KINESIS_STREAM_NAME}
    Retry_Limit     False
    # Time_Key        timestamp
    # Time_Key_Format %Y-%m-%d %H:%M:%S.%L